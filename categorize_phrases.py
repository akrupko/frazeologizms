#!/usr/bin/env python3
"""
Script to analyze phraseological units and categorize them into thematic groups.
"""

import json
import re
from collections import defaultdict

def analyze_phrases():
    """Analyze phraseological units and categorize them."""
    
    # Load the data
    with open('table_phrases.json', 'r', encoding='utf-8') as f:
        phrases = json.load(f)
    
    print(f"Loaded {len(phrases)} phrases")
    
    # Define thematic categories based on content analysis
    categories = {
        'animals': {
            'name': 'Животные и природа',
            'description': 'Фразеологизмы с животными, птицами и природными явлениями',
            'keywords': ['кот', 'собак', 'волк', 'лиса', 'медвед', 'заяц', 'мыш', 'птиц', 'конь', 'лошад', 'корова', 'овц', 'козел', 'баран', 'рыб', 'змея', 'лев', 'тигр', 'слон', 'орел', 'ворон', 'сорок', 'воробей', 'гус', 'утк', 'петух', 'курица'],
            'phrases': []
        },
        'body_parts': {
            'name': 'Части тела',
            'description': 'Фразеологизмы с частями тела человека',
            'keywords': ['голова', 'глаз', 'ухо', 'нос', 'рот', 'язык', 'зуб', 'рука', 'нога', 'пальц', 'плечо', 'спина', 'грудь', 'сердце', 'душа', 'живот', 'шея', 'лицо', 'лоб', 'борода', 'волос', 'кожа'],
            'phrases': []
        },
        'religion_mythology': {
            'name': 'Религия и мифология',
            'description': 'Фразеологизмы с религиозными и мифологическими мотивами',
            'keywords': ['бог', 'черт', 'дьявол', 'ад', 'рай', 'ангел', 'душа', 'грех', 'молитв', 'церков', 'святой', 'божий', 'господь', 'христос', 'библия', 'античн', 'греческ', 'мифолог', 'легенда', 'авгиев', 'ахиллес'],
            'phrases': []
        },
        'work_labor': {
            'name': 'Труд и работа',
            'description': 'Фразеологизмы о работе, труде и профессиональной деятельности',
            'keywords': ['работ', 'труд', 'дело', 'служб', 'ремесл', 'мастер', 'артель', 'пахать', 'сеять', 'жать', 'коси', 'молот', 'кузнец', 'столяр', 'плотник', 'швея', 'портной'],
            'phrases': []
        },
        'money_wealth': {
            'name': 'Деньги и богатство',
            'description': 'Фразеологизмы о деньгах, богатстве и бедности',
            'keywords': ['деньги', 'богат', 'беден', 'золото', 'серебро', 'копейк', 'рубль', 'бедност', 'нищет', 'богатств', 'клад', 'сокровищ', 'монет', 'бюджет', 'долг', 'заем', 'кредит'],
            'phrases': []
        },
        'family_relationships': {
            'name': 'Семья и отношения',
            'description': 'Фразеологизмы о семейных отношениях и родственных связях',
            'keywords': ['мать', 'отец', 'сын', 'дочь', 'брат', 'сестра', 'дед', 'бабушк', 'внук', 'муж', 'жена', 'семья', 'род', 'детей', 'ребенок', 'супруг', 'свадьб', 'женить', 'замуж'],
            'phrases': []
        },
        'time_age': {
            'name': 'Время и возраст',
            'description': 'Фразеологизмы о времени, возрасте и жизненных периодах',
            'keywords': ['время', 'год', 'день', 'ночь', 'утро', 'вечер', 'час', 'минут', 'секунд', 'возраст', 'молод', 'стар', 'детств', 'юность', 'зрелост', 'старост', 'век', 'эпох', 'сезон', 'месяц', 'неделя'],
            'phrases': []
        },
        'emotions_feelings': {
            'name': 'Эмоции и чувства',
            'description': 'Фразеологизмы о эмоциональных состояниях и переживаниях',
            'keywords': ['любовь', 'ненавист', 'радост', 'грусть', 'печаль', 'страх', 'ужас', 'гнев', 'злост', 'ярост', 'счастье', 'горе', 'тоска', 'скука', 'весел', 'смех', 'слезы', 'плач', 'обида', 'зависть', 'ревност'],
            'phrases': []
        },
        'mind_intelligence': {
            'name': 'Ум и глупость',
            'description': 'Фразеологизмы об интеллектуальных способностях',
            'keywords': ['ум', 'глупост', 'дурак', 'дура', 'мудр', 'мозг', 'разум', 'рассудок', 'память', 'забыв', 'помнить', 'думать', 'соображ', 'понима', 'знать', 'учить', 'образован'],
            'phrases': []
        },
        'speech_communication': {
            'name': 'Речь и общение',
            'description': 'Фразеологизмы о речи, общении и языке',
            'keywords': ['говорить', 'сказать', 'слово', 'речь', 'язык', 'молчать', 'кричать', 'шептать', 'болтать', 'рассказ', 'беседа', 'разговор', 'спор', 'ссора', 'ругать', 'хвалить', 'обещать'],
            'phrases': []
        },
        'appearance_beauty': {
            'name': 'Внешность и красота',
            'description': 'Фразеологизмы о внешнем виде и красоте',
            'keywords': ['красив', 'урод', 'внешност', 'вид', 'облик', 'лицо', 'фигура', 'рост', 'толст', 'худой', 'сильн', 'слаб', 'здоров', 'больн', 'цвет', 'белый', 'черный', 'красный'],
            'phrases': []
        },
        'food_drink': {
            'name': 'Еда и питье',
            'description': 'Фразеологизмы о пище и напитках',
            'keywords': ['есть', 'пить', 'хлеб', 'мясо', 'молоко', 'вода', 'вино', 'пиво', 'чай', 'кофе', 'сахар', 'соль', 'масло', 'каша', 'суп', 'блюдо', 'кухня', 'стол', 'обед', 'ужин', 'завтрак', 'голод', 'сыт'],
            'phrases': []
        },
        'war_conflict': {
            'name': 'Война и конфликты',
            'description': 'Фразеологизмы о военных действиях и конфликтах',
            'keywords': ['война', 'битва', 'бой', 'сражение', 'враг', 'друг', 'солдат', 'офицер', 'генерал', 'армия', 'полк', 'оружие', 'меч', 'копье', 'пушка', 'ружье', 'победа', 'поражение', 'мир', 'драка', 'ссора'],
            'phrases': []
        },
        'house_home': {
            'name': 'Дом и быт',
            'description': 'Фразеологизмы о доме, жилище и повседневной жизни',
            'keywords': ['дом', 'изба', 'хата', 'квартира', 'комната', 'кухня', 'двор', 'сад', 'огород', 'крыша', 'стена', 'дверь', 'окно', 'стол', 'стул', 'кровать', 'печь', 'очаг', 'быт', 'хозяйств'],
            'phrases': []
        },
        'weather_nature': {
            'name': 'Погода и природа',
            'description': 'Фразеологизмы о погодных явлениях и природе',
            'keywords': ['дождь', 'снег', 'ветер', 'буря', 'гроза', 'туман', 'солнце', 'луна', 'звезд', 'небо', 'земля', 'море', 'река', 'лес', 'поле', 'гора', 'холод', 'тепло', 'жара', 'мороз', 'лето', 'зима', 'весна', 'осень'],
            'phrases': []
        },
        'transport_travel': {
            'name': 'Транспорт и путешествия',
            'description': 'Фразеологизмы о передвижении и путешествиях',
            'keywords': ['дорога', 'путь', 'ехать', 'идти', 'бежать', 'лететь', 'плыть', 'корабль', 'лодка', 'телега', 'сани', 'лошадь', 'воз', 'путешеств', 'поездка', 'прогулка'],
            'phrases': []
        },
        'clothes_appearance': {
            'name': 'Одежда и облик',
            'description': 'Фразеологизмы об одежде и внешнем облике',
            'keywords': ['одежда', 'платье', 'рубашка', 'штаны', 'юбка', 'пальто', 'шуба', 'шапка', 'сапоги', 'туфли', 'пояс', 'ткань', 'шить', 'кроить', 'модный', 'старый', 'новый'],
            'phrases': []
        },
        'luck_fortune': {
            'name': 'Удача и судьба',
            'description': 'Фразеологизмы о везении, невезении и судьбе',
            'keywords': ['удача', 'везение', 'судьба', 'рок', 'счастье', 'несчастье', 'участь', 'доля', 'жребий', 'случай', 'везти', 'фортуна', 'звезда'],
            'phrases': []
        },
        'education_knowledge': {
            'name': 'Образование и знания',
            'description': 'Фразеологизмы об обучении и познании',
            'keywords': ['учить', 'изучать', 'знание', 'наука', 'школа', 'учитель', 'ученик', 'урок', 'книга', 'читать', 'писать', 'образование', 'мудрость', 'опыт'],
            'phrases': []
        },
        'love_romance': {
            'name': 'Любовь и романтика',
            'description': 'Фразеологизмы о любовных отношениях',
            'keywords': ['любовь', 'любить', 'влюбл', 'сердце', 'страсть', 'поцелуй', 'объятия', 'романтика', 'свидание', 'жених', 'невеста', 'ухажив'],
            'phrases': []
        },
        'quantity_measure': {
            'name': 'Количество и мера',
            'description': 'Фразеологизмы о количестве, размере и мере',
            'keywords': ['много', 'мало', 'больш', 'маленьк', 'огромн', 'крошечн', 'длинн', 'коротк', 'широк', 'узк', 'высок', 'низк', 'глубок', 'мелк', 'толст', 'тонк', 'размер', 'мера'],
            'phrases': []
        },
        'colors_light': {
            'name': 'Цвета и свет',
            'description': 'Фразеологизмы с цветами и световыми явлениями',
            'keywords': ['белый', 'черный', 'красный', 'синий', 'зеленый', 'желтый', 'серый', 'розовый', 'фиолетов', 'свет', 'тьма', 'темнота', 'яркий', 'тусклый', 'блеск', 'сиять'],
            'phrases': []
        },
        'games_entertainment': {
            'name': 'Игры и развлечения',
            'description': 'Фразеологизмы об играх и развлечениях',
            'keywords': ['игра', 'играть', 'карты', 'кости', 'шахматы', 'танец', 'песня', 'музыка', 'праздник', 'веселье', 'забава', 'развлечение'],
            'phrases': []
        },
        'health_disease': {
            'name': 'Здоровье и болезни',
            'description': 'Фразеологизмы о здоровье и недугах',
            'keywords': ['здоровье', 'болезнь', 'больной', 'здоровый', 'лечить', 'врач', 'лекарство', 'боль', 'рана', 'язва', 'лихорадка', 'кашель', 'чума', 'смерть', 'умереть'],
            'phrases': []
        },
        'social_status': {
            'name': 'Социальный статус',
            'description': 'Фразеологизмы о социальном положении и статусе',
            'keywords': ['царь', 'король', 'барин', 'господин', 'дворянин', 'крестьянин', 'слуга', 'холоп', 'рабство', 'свобода', 'власть', 'начальник', 'подчиненный', 'чин', 'звание'],
            'phrases': []
        },
        'business_trade': {
            'name': 'Торговля и дело',
            'description': 'Фразеологизмы о торговле и деловых отношениях',
            'keywords': ['торговля', 'торговать', 'купить', 'продать', 'цена', 'дорого', 'дешево', 'прибыль', 'убыток', 'товар', 'рынок', 'лавка', 'магазин', 'дело', 'сделка'],
            'phrases': []
        },
        'character_behavior': {
            'name': 'Характер и поведение',
            'description': 'Фразеологизмы о человеческом характере и поведении',
            'keywords': ['характер', 'нрав', 'поведение', 'добрый', 'злой', 'хороший', 'плохой', 'честный', 'лживый', 'храбрый', 'трусливый', 'гордый', 'скромный', 'жадный', 'щедрый', 'ленивый', 'трудолюбив'],
            'phrases': []
        },
        'ancient_historical': {
            'name': 'Исторические и античные',
            'description': 'Фразеологизмы с историческими и античными корнями',
            'keywords': ['античн', 'древн', 'греческ', 'римск', 'историческ', 'царь', 'император', 'фараон', 'библейск', 'легендарн', 'мифическ'],
            'phrases': []
        },
        'literary_cultural': {
            'name': 'Литературные и культурные',
            'description': 'Фразеологизмы из литературы и культуры',
            'keywords': ['литератур', 'поэзия', 'стихи', 'роман', 'пьеса', 'театр', 'актер', 'поэт', 'писатель', 'культур', 'искусств', 'творчеств'],
            'phrases': []
        },
        'general': {
            'name': 'Общие выражения',
            'description': 'Различные фразеологизмы общего характера',
            'keywords': [],
            'phrases': []
        }
    }
    
    # Categorize phrases
    for phrase_data in phrases:
        phrase = phrase_data['phrase'].lower()
        meanings = ' '.join(phrase_data['meanings']).lower()
        etymology = phrase_data.get('etymology', '').lower()
        
        full_text = f"{phrase} {meanings} {etymology}"
        
        # Find matching categories
        matched_categories = []
        for category_key, category_data in categories.items():
            if category_key == 'general':
                continue
                
            for keyword in category_data['keywords']:
                if keyword in full_text:
                    matched_categories.append(category_key)
                    break
        
        # If no category matched, put in general
        if not matched_categories:
            categories['general']['phrases'].append(phrase_data)
        else:
            # Add to first matching category
            categories[matched_categories[0]]['phrases'].append(phrase_data)
    
    # Filter out empty categories and limit to 20-35 categories
    filtered_categories = {}
    for key, data in categories.items():
        if len(data['phrases']) >= 5:  # Minimum 5 phrases per category
            filtered_categories[key] = data
    
    # Sort by number of phrases (descending)
    sorted_categories = dict(sorted(filtered_categories.items(), 
                                  key=lambda x: len(x[1]['phrases']), 
                                  reverse=True))
    
    # Take top 25 categories (within 20-35 range)
    final_categories = dict(list(sorted_categories.items())[:25])
    
    # Print statistics
    print(f"\nCreated {len(final_categories)} thematic categories:")
    total_phrases = 0
    for key, data in final_categories.items():
        count = len(data['phrases'])
        total_phrases += count
        print(f"- {data['name']}: {count} phrases")
    
    print(f"\nTotal phrases categorized: {total_phrases}")
    
    # Save categorized data
    with open('categorized_phrases.json', 'w', encoding='utf-8') as f:
        json.dump(final_categories, f, ensure_ascii=False, indent=2)
    
    print("Saved categorized data to categorized_phrases.json")
    
    return final_categories

if __name__ == "__main__":
    analyze_phrases()